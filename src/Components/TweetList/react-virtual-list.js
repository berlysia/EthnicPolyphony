!function(t, e) { "object" == typeof exports && "object" == typeof module ? module.exports = e(require("react"), require("react-dom")) : "function" == typeof define && define.amd ? define(["react", "react-dom"], e) : "object" == typeof exports ? exports.VirtualList = e(require("react"), require("react-dom")) : t.VirtualList = e(t.React, t.ReactDOM) } (this, function(t, e) { return function(t) { function e(i) { if (n[i]) return n[i].exports; var r = n[i] = { exports: {}, id: i, loaded: !1 }; return t[i].call(r.exports, r, r.exports, e), r.loaded = !0, r.exports } var n = {}; return e.m = t, e.c = n, e.p = "", e(0) } ([function(t, e, n) { t.exports = n(4) }, function(t, e) { "use strict"; function n(t) { this.bit = Array(t.length + 1).fill(0), this.values = Array(t.length).fill(0), this.set = function(t, e) { var n = e - this.values[t]; this.values[t] += n, t++; for (var i = t, r = this.bit.length - 1; r >= i; i += i & -i)null == this.bit[i] && (this.bit[i] = 0), this.bit[i] += n }, this.get = function(t) { t++; for (var e = 0, n = t; n > 0; n -= n & -n)e += this.bit[n]; return e || 0 }, this.sum = function() { return this.get(this.bit.length - 2) }, this.lowerBound = function(t) { for (var e, n = 1, i = this.bit.length; i - n > 1;)e = n + i >> 1, this.get(e) < t ? n = e : i = e; return n - 1 }; for (var e = 0, n = t.length; n > e; ++e)this.set(e, t[e]) } Object.defineProperty(e, "__esModule", { value: !0 }), e["default"] = n }, function(t, e, n) { "use strict"; function i(t) { return t && t.__esModule ? t : { "default": t } } function r(t) { var e; this.el = t; var n = function() { return e = { top: s(t), height: t.clientHeight || t.innerHeight } }; this.size = function() { return e || n() }, this.getScrollTop = function() { var e = t.scrollTop; return "undefined" == typeof e && (e = t.scrollY || t.pageYOffset), e }, this.reset = function() { e = null } } function o(t, e, n, i, r) { function o(t, e) { var n = p.get(t); l.set(n, e), d() } var u, h = this; this.el = t; var f = new a["default"](i), l = new c["default"](e.map(function(t) { return f.has(t) ? f.get(t) : n })), p = new Map; e.forEach(function(t, e) { return p.set(r(t), e) }); var d = function() { return u = { top: s(h.el), height: l.sum() }, console.log(u, l), u }; f.onChange(o.bind(this)), this.lowerBound = function(t) { return l.lowerBound(t) }, this.getOffset = function(t) { return l.get(t) }, this.size = function() { return u || d() }, this.reset = function() { u = null } } function s(t) { if (t === window) return 0; for (var e = 0; t;)e += t.offsetTop, t = t.offsetParent; return e } Object.defineProperty(e, "__esModule", { value: !0 }), e.Viewport = r, e.ContentBox = o; var u = n(3), a = i(u), h = n(1), c = i(h) }, function(t, e) { "use strict"; function n(t) { var e = []; this.onChange = function(t) { return e.push(t), function() { e.splice(e.findIndex(t), 1) } }, this.emitChange = function(t, n) { e.forEach(function(e) { return e(t, n) }) }, this.has = function(e) { return t.has(e) }, this.get = function(e) { return t.get(e) }, this.set = function(e, n) { t.set(e, n), this.emitChange(e, n) } } Object.defineProperty(e, "__esModule", { value: !0 }), e["default"] = n }, function(t, e, n) { "use strict"; function i(t) { return t && t.__esModule ? t : { "default": t } } Object.defineProperty(e, "__esModule", { value: !0 }); var r = n(7), o = i(r), s = n(8), u = i(s), a = n(6), h = i(a), c = n(5), f = i(c), l = function(t) { return t }, p = o["default"].createClass({ displayName: "VerticalList", scrollDebounce: null, virtualState: null, propTypes: { itemHeight: o["default"].PropTypes.number.isRequired, itemFactory: o["default"].PropTypes.func.isRequired, items: o["default"].PropTypes.array, keyFromItem: o["default"].PropTypes.func, heightCache: o["default"].PropTypes.object, bufferSize: o["default"].PropTypes.number, viewport: o["default"].PropTypes.object, tagName: o["default"].PropTypes.string }, getDefaultProps: function() { return { viewport: window, items: [], bufferSize: 0, tagName: "ul", heightCache: new Map, keyFromItem: l } }, getInitialState: function() { return { contentHeight: 0, topOffset: 0, items: [] } }, componentWillMount: function() { var t = this; this.updateDebounce = (0, h["default"])(this.update), this.resetStateDebounce = (0, h["default"])(function() { return t.virtualState.reset() }) }, componentDidMount: function() { this.initVirtualState(this.props), this.bindEvents(this.props), this.update() }, componentWillUnmount: function() { this.unbindEvents(this.props) }, shouldComponentUpdate: function(t, e) { return this.state.contentHeight !== e.contentHeight ? !0 : this.state.items.length !== e.items.length ? !0 : this.state.topOffset !== e.topOffset }, componentWillReceiveProps: function(t) { this.initVirtualState(t), this.unbindEvents(t), this.bindEvents(t), this.update() }, initVirtualState: function(t) { this.virtualState = new f["default"](t.viewport, u["default"].findDOMNode(this), t.items, t.itemHeight, t.bufferSize, t.heightCache, t.keyFromItem) }, bindEvents: function(t) { t.viewport.addEventListener("scroll", this.handleScroll), t.viewport === window && t.viewport.addEventListener("resize", this.handleResize) }, unbindEvents: function(t) { t.viewport.removeEventListener("scroll", this.handleScroll), t.viewport.removeEventListener("resize", this.handleResize) }, update: function(t) { t && this.virtualState.reset(), this.setState(this.virtualState.calculate()) }, handleScroll: function() { this.updateDebounce.request() }, handleResize: function() { this.virtualState.reset(), this.updateDebounce.request() }, updateHeightCache: function(t, e) { this.props.heightCache.set(this.props.keyFromItem(t), e), this.updateDebounce.request() }, renderItems: function() { var t = this; return this.state.items.map(function(e) { return t.props.itemFactory(e, t.props, t.state, t.updateHeightCache) }) }, render: function() { var t = { boxSizing: "border-box", height: this.state.contentHeight + "px", paddingTop: this.state.topOffset + "px" }; return o["default"].createElement(this.props.tagName, { style: t }, this.renderItems()) } }); e["default"] = p }, function(t, e, n) { "use strict"; function i(t, e, n, i, o, s, u) { this.viewport = new r.Viewport(t), this.contentBox = new r.ContentBox(e, n, i, s, u); var a = { contentHeight: 0, topOffset: 0, items: [] }; this.calculate = function() { if (0 >= i) return a; var t = this.viewport.size().top - this.contentBox.size().top + this.viewport.getScrollTop(), e = Math.min(this.viewport.size().height, this.viewport.size().height + t), r = Math.max(0, this.contentBox.lowerBound(t) - 1), s = Math.max(r + 1, this.contentBox.lowerBound(t + e)); return o && (r = Math.max(0, r - o), s += o), a.contentHeight = this.contentBox.size().height, a.topOffset = r > 0 ? this.contentBox.getOffset(r - 1) : 0, a.items = n.slice(r, s), console.log("calculate", a), a }, this.reset = function() { this.viewport.reset(), this.contentBox.reset() } } Object.defineProperty(e, "__esModule", { value: !0 }); var r = n(2); e["default"] = i }, function(t, e) { "use strict"; function n(t) { var e = !1, n = function() { t(), e = !1 }; return { request: function() { e || (requestAnimationFrame(n), e = !0) } } } Object.defineProperty(e, "__esModule", { value: !0 }), e["default"] = n }, function(e, n) { e.exports = t }, function(t, n) { t.exports = e }]) });
//# sourceMappingURL=react-virtual-list.js.map
